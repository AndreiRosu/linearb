{"version":3,"file":"linode-logger.cjs.development.js","sources":["../src/utils.ts","../src/middlewares.ts","../src/index.ts"],"sourcesContent":["import { URL } from 'url';\n\nexport const FIELDS_TO_OMIT = [\n  'authorization',\n  'token',\n  'password',\n  'code',\n  'pass',\n  'key',\n  'access_token',\n  'access_token_secret',\n  'refresh_token',\n  'accessToken',\n  'refreshToken',\n  'cookie'\n];\n\nexport const StringifyReplacer = (circular = true, omitFields = true) => {\n  const seen = new WeakSet(); //week reference for quick gc\n  return (key, value) => {\n    if (circular && typeof value === 'object' && value !== null) {\n      if (seen.has(value)) {\n        console.error(`Circular Object key detected: ${key}`);\n        return '#CircularRefParentObject';\n      }\n      seen.add(value);\n    }\n    if (omitFields && FIELDS_TO_OMIT.includes(key) && typeof value === 'string')\n      return value.substring(0, 3) + '*****' + value.slice(-1);\n\n    return value;\n  };\n};\n\nexport const SafeStringifyReplacer = (\n  obj: any,\n  omit?: boolean | undefined,\n  space?: string | number | undefined\n): string => {\n  try {\n    return JSON.stringify(obj, StringifyReplacer(false, omit), space);\n  } catch (e) {\n    return JSON.stringify(obj, StringifyReplacer(true, omit), space);\n  }\n};\n\nexport const parseURL = (url: string) => {\n  try {\n    let parsedUrl = new URL(url);\n    let dict = {};\n    parsedUrl.searchParams.forEach((value, key) => {\n      if (dict[key]) {\n        dict[key].push(value);\n      } else {\n        dict[key] = [value];\n      }\n    });\n    // reassign query as old url.parse\n    parsedUrl['query'] = dict;\n    return parsedUrl;\n  } catch (e) {\n    return {};\n  }\n};\n","import morgan from 'morgan';\nimport _ from 'lodash';\nimport httpContext from 'express-http-context';\nimport { v4 } from 'uuid';\nimport { FIELDS_TO_OMIT } from './utils';\n\n/**\n each request will have all of the context\n */\nexport function contextifyRequestMiddleware(req, res, next) {\n  const accountId = _.get(req, 'headers.id', '').toString();\n  const organizationId = _.get(req, 'headers.organization_id', '').toString();\n  const headerRequestId = _.get(req, 'headers.x-request-id', null);\n  const headerSourceRequestId = _.get(req, 'headers.source-x-request-id', null);\n  const queryRequestId = _.get(req, 'query.x-request-id', null);\n  const querySourceRequestId = _.get(req, 'query.source-x-request-id', null);\n  const requestId = headerRequestId || queryRequestId || v4();\n  const sourceRequestId = headerSourceRequestId || querySourceRequestId;\n  const amznTraceId = _.get(req, 'headers.x-amzn-trace-id', null);\n\n  if (!headerRequestId) {\n    req.headers['x-request-id'] = requestId;\n  }\n\n  if (sourceRequestId) {\n    httpContext.set('sourceRequestId', sourceRequestId);\n  }\n\n  httpContext.set('headers', _.omit(req.headers, FIELDS_TO_OMIT));\n  httpContext.set('body', req.body);\n  httpContext.set('params', req.params);\n  httpContext.set('query', req.query);\n  httpContext.set('originalUrl', req.originalUrl);\n  httpContext.set('method', req.method);\n  httpContext.set('amznTraceId', amznTraceId);\n  httpContext.set('requestId', requestId);\n  httpContext.set('accountId', accountId);\n  httpContext.set('organizationId', organizationId);\n\n  next();\n}\n\nexport function expressLogger(logger, consoleLevel) {\n  return morgan(\n    function (tokens, req, res) {\n      const amznTraceId = httpContext.get('amznTraceId');\n      const logInfo = {\n        method: tokens.method(req, res),\n        status: Number(tokens.status(req, res)),\n        url: tokens.url(req, res),\n        headers: httpContext.get('headers'),\n        'response-time': `${tokens['response-time'](req, res)} ms`,\n        'x-request-id': httpContext.get('requestId'),\n        body: httpContext.get('body'),\n        query: httpContext.get('query'),\n        ...(amznTraceId ? { [`x-amzn-trace-id`]: amznTraceId } : {})\n      };\n      const noQsUrl = (logInfo.url || '').split('?')[0];\n      logInfo.status < 400\n        ? logger.debug('', logInfo)\n        : logger.error(`[Extended log]: ${logInfo.status} ${logInfo.method} ${noQsUrl}`, logInfo);\n    },\n    {\n      stream: {\n        //dont use write stream as we return null from the above custom formatter, and output msg from it\n        write: function (msg) {}\n      },\n      skip: function (req, res) {\n        return res.statusCode > 199 && res.statusCode < 400 && consoleLevel !== 'debug';\n      }\n    }\n  );\n}\n","import { transports, format, createLogger as wCreateLogger } from 'winston';\nimport httpContext from 'express-http-context';\nimport _ from 'lodash';\nimport { expressLogger, contextifyRequestMiddleware } from './middlewares';\nimport { SafeStringifyReplacer, parseURL } from './utils';\nconst { combine, timestamp, printf, colorize } = format;\n\nconst DEFAULT_OPTIONS = {\n  consoleLevel: 'debug'\n};\n\nconst jsonFormat = printf(({ level, timestamp, message = '', ...ctx }) =>\n  SafeStringifyReplacer({ timestamp, level, message, ctx }, true)\n);\n\nconst localFormat = printf(\n  ({ level, timestamp, message = '', error, ...ctx }) =>\n    `${timestamp} [${level}]: ${SafeStringifyReplacer({ message, ctx }, false)}\\n` +\n    `${error ? SafeStringifyReplacer(error, false, 2) : ''}`\n);\n\nconst getOptions = (options = {}) => {\n  return Object.assign({}, DEFAULT_OPTIONS, process.env, options) as any;\n};\n\nfunction addContext(key, value) {\n  httpContext.set('extendedContext', {\n    ...(httpContext.get('extendedContext') || {}),\n    [key]: value\n  });\n}\n\nexport function createLogger(options) {\n  const { GIT_COMMIT_SHORT, app, environment, consoleLevel } = getOptions(options);\n\n  const _transports = [\n    new transports.Console({\n      level: consoleLevel,\n      handleExceptions: true\n    })\n  ];\n\n  const logger = wCreateLogger({\n    transports: _transports,\n    exitOnError: false,\n    format: environment.includes('local')\n      ? combine(timestamp(), colorize(), localFormat)\n      : combine(timestamp(), jsonFormat),\n\n    defaultMeta: {\n      app,\n      environment,\n      ...(GIT_COMMIT_SHORT ? { commit_sha: GIT_COMMIT_SHORT } : {})\n    }\n  });\n\n  // adding default context for every log\n  const contextifyLogFn = logFn => (message, ctx) => {\n    const source_request_id = httpContext.get('sourceRequestId');\n    const request_id = httpContext.get('requestId');\n    const account_id = httpContext.get('accountId');\n    const org_id = httpContext.get('organizationId');\n    const extendedContext = httpContext.get('extendedContext') || {};\n\n    return logFn({\n      message,\n      ...ctx,\n      environment,\n      app,\n      'x-request-id': request_id,\n      ...(source_request_id ? { source_request_id } : {}),\n      ...(account_id ? { account_id } : {}),\n      ...(org_id ? { org_id } : {}),\n      ...extendedContext\n    });\n  };\n\n  return {\n    level: consoleLevel,\n    embed(expressApp) {\n      expressApp.use(httpContext.middleware);\n      expressApp.use(contextifyRequestMiddleware);\n      expressApp.use(expressLogger(logger, consoleLevel));\n    },\n    debug(msg: string, ctx = {}) {\n      contextifyLogFn(logger.debug)(msg, ctx);\n    },\n    verbose(msg: string, ctx = {}) {\n      contextifyLogFn(logger.verbose)(msg, ctx);\n    },\n    info(msg: string, ctx = {}) {\n      contextifyLogFn(logger.info)(msg, ctx);\n    },\n    warn(msg: string, ctx = {}) {\n      contextifyLogFn(logger.warn)(msg, ctx);\n    },\n    error(msg: string, error = {}) {\n      let ctxError = { ...error };\n      if (error['isAxiosError']) {\n        let parsed_url = parseURL(_.get(error, 'config.url', ''));\n        let queryParams = Object.assign(\n          _.get(parsed_url, 'query', {}),\n          _.get(error, 'config.params', {})\n        );\n        ctxError['httpClientResponseQueryParams'] = SafeStringifyReplacer(queryParams, true);\n        ctxError['httpClientResponseURL'] =\n          _.get(error, 'config.baseURL', '') + _.get(parsed_url, 'pathname', '');\n        ctxError['httpClientResponseMethod'] = _.get(error, 'config.method', null);\n        ctxError['httpClientResponseStatusCode'] = _.get(error, 'response.status', null);\n        ctxError['httpClientResponseMessage'] = _.get(error, 'response.data.message', null);\n      }\n      const request = {\n        headers: httpContext.get('headers'),\n        body: httpContext.get('body'),\n        params: httpContext.get('params'),\n        query: httpContext.get('query'),\n        originalUrl: httpContext.get('originalUrl'),\n        method: httpContext.get('method')\n      };\n      contextifyLogFn(logger.error)(msg, { ctxError, request });\n    },\n    addContext\n  };\n}\n\nexport * from './utils';\n"],"names":["FIELDS_TO_OMIT","StringifyReplacer","circular","omitFields","seen","WeakSet","key","value","has","console","error","add","includes","substring","slice","SafeStringifyReplacer","obj","omit","space","JSON","stringify","e","parseURL","url","parsedUrl","URL","dict","searchParams","forEach","push","contextifyRequestMiddleware","req","res","next","accountId","_","get","toString","organizationId","headerRequestId","headerSourceRequestId","queryRequestId","querySourceRequestId","requestId","v4","sourceRequestId","amznTraceId","headers","httpContext","set","body","params","query","originalUrl","method","expressLogger","logger","consoleLevel","morgan","tokens","logInfo","status","Number","noQsUrl","split","debug","stream","write","msg","skip","statusCode","combine","format","timestamp","printf","colorize","DEFAULT_OPTIONS","jsonFormat","level","message","ctx","localFormat","getOptions","options","Object","assign","process","env","addContext","createLogger","GIT_COMMIT_SHORT","app","environment","_transports","transports","Console","handleExceptions","wCreateLogger","exitOnError","defaultMeta","commit_sha","contextifyLogFn","logFn","source_request_id","request_id","account_id","org_id","extendedContext","embed","expressApp","use","middleware","verbose","info","warn","ctxError","parsed_url","queryParams","request"],"mappings":"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"}